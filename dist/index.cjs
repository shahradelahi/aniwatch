"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } async function _asyncNullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return await rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } async function _asyncOptionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = await fn(value); } else if (op === 'call' || op === 'optionalCall') { value = await fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } var _class; var _class2; var _class3;var _cheerio = require('cheerio');var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);var Q="gzip, deflate, br",k="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4692.71 Safari/537.36",Z="text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",be="hianime.to",A=`https://${be}`,R=`${A}/ajax`,N=`${A}/home`,ee=`${A}/search`,te={action:1,adventure:2,cars:3,comedy:4,dementia:5,demons:6,drama:8,ecchi:9,fantasy:10,game:11,harem:35,historical:13,horror:14,isekai:44,josei:43,kids:15,magic:16,"martial-arts":17,mecha:18,military:38,music:19,mystery:7,parody:20,police:39,psychological:40,romance:22,samurai:21,school:23,"sci-fi":24,seinen:42,shoujo:25,"shoujo-ai":26,shounen:27,"shounen-ai":28,"slice-of-life":36,space:29,sports:30,"super-power":31,supernatural:37,thriller:41,vampire:32},re={all:0,movie:1,tv:2,ova:3,ona:4,special:5,music:6},ie={all:0,"finished-airing":1,"currently-airing":2,"not-yet-aired":3},ne={all:0,g:1,pg:2,"pg-13":3,r:4,"r+":5,rx:6},ae={all:0,appalling:1,horrible:2,"very-bad":3,bad:4,average:5,fine:6,good:7,"very-good":8,great:9,masterpiece:10},oe={all:0,spring:1,summer:2,fall:3,winter:4},se={all:0,sub:1,dub:2,"sub-&-dub":3},ce={default:"default","recently-added":"recently_added","recently-updated":"recently_updated",score:"score","name-a-z":"name_az","released-date":"released_date","most-watched":"most_watched"};function y(i={}){return _axios2.default.create({timeout:8e3,...i,headers:{...i.headers,Accept:Z,"User-Agent":k,"Accept-Encoding":Q}})}var _e="\x1B[31m%s\x1B[0m",D="Something went wrong",d= exports.AniwatchError =class i extends Error{constructor(t,e){super(`${e}: ${t}`),this.name=i.name,this.scraper=e,Error.captureStackTrace&&Error.captureStackTrace(this,i),this.logError()}static wrapError(t,e){if(t instanceof i)return t;if(t instanceof _axios.AxiosError){let a=_optionalChain([t, 'optionalAccess', _2 => _2.response, 'optionalAccess', _3 => _3.statusText])||D;return new i("fetch_err: "+a,e)}return new i(_optionalChain([t, 'optionalAccess', _4 => _4.message])||D,e)}logError(){console.error(_e,JSON.stringify({scraper:this.scraper,message:_optionalChain([this, 'optionalAccess', _5 => _5.message])||D},null,2))}};var S=(i,t,e)=>{try{let a=[];return i(t).each((n,o)=>{let r=_optionalChain([i, 'call', _6 => _6(o), 'access', _7 => _7.find, 'call', _8 => _8(".film-detail .film-name .dynamic-name"), 'optionalAccess', _9 => _9.attr, 'call', _10 => _10("href"), 'optionalAccess', _11 => _11.slice, 'call', _12 => _12(1), 'access', _13 => _13.split, 'call', _14 => _14("?ref=search"), 'access', _15 => _15[0]])||null;a.push({id:r,name:_optionalChain([i, 'call', _16 => _16(o), 'access', _17 => _17.find, 'call', _18 => _18(".film-detail .film-name .dynamic-name"), 'optionalAccess', _19 => _19.text, 'call', _20 => _20(), 'optionalAccess', _21 => _21.trim, 'call', _22 => _22()]),jname:_optionalChain([i, 'call', _23 => _23(o), 'access', _24 => _24.find, 'call', _25 => _25(".film-detail .film-name .dynamic-name"), 'optionalAccess', _26 => _26.attr, 'call', _27 => _27("data-jname"), 'optionalAccess', _28 => _28.trim, 'call', _29 => _29()])||null,poster:_optionalChain([i, 'call', _30 => _30(o), 'access', _31 => _31.find, 'call', _32 => _32(".film-poster .film-poster-img"), 'optionalAccess', _33 => _33.attr, 'call', _34 => _34("data-src"), 'optionalAccess', _35 => _35.trim, 'call', _36 => _36()])||null,duration:_optionalChain([i, 'call', _37 => _37(o), 'access', _38 => _38.find, 'call', _39 => _39(".film-detail .fd-infor .fdi-item.fdi-duration"), 'optionalAccess', _40 => _40.text, 'call', _41 => _41(), 'optionalAccess', _42 => _42.trim, 'call', _43 => _43()]),type:_optionalChain([i, 'call', _44 => _44(o), 'access', _45 => _45.find, 'call', _46 => _46(".film-detail .fd-infor .fdi-item:nth-of-type(1)"), 'optionalAccess', _47 => _47.text, 'call', _48 => _48(), 'optionalAccess', _49 => _49.trim, 'call', _50 => _50()]),rating:_optionalChain([i, 'call', _51 => _51(o), 'access', _52 => _52.find, 'call', _53 => _53(".film-poster .tick-rate"), 'optionalAccess', _54 => _54.text, 'call', _55 => _55(), 'optionalAccess', _56 => _56.trim, 'call', _57 => _57()])||null,episodes:{sub:Number(_optionalChain([i, 'call', _58 => _58(o), 'access', _59 => _59.find, 'call', _60 => _60(".film-poster .tick-sub"), 'optionalAccess', _61 => _61.text, 'call', _62 => _62(), 'optionalAccess', _63 => _63.trim, 'call', _64 => _64(), 'access', _65 => _65.split, 'call', _66 => _66(" "), 'access', _67 => _67.pop, 'call', _68 => _68()]))||null,dub:Number(_optionalChain([i, 'call', _69 => _69(o), 'access', _70 => _70.find, 'call', _71 => _71(".film-poster .tick-dub"), 'optionalAccess', _72 => _72.text, 'call', _73 => _73(), 'optionalAccess', _74 => _74.trim, 'call', _75 => _75(), 'access', _76 => _76.split, 'call', _77 => _77(" "), 'access', _78 => _78.pop, 'call', _79 => _79()]))||null}})}),a}catch(a){throw d.wrapError(a,e)}},_=(i,t,e)=>{try{let a=[],n=`#top-viewed-${t} ul li`;return i(n).each((o,r)=>{a.push({id:_optionalChain([i, 'call', _80 => _80(r), 'access', _81 => _81.find, 'call', _82 => _82(".film-detail .dynamic-name"), 'optionalAccess', _83 => _83.attr, 'call', _84 => _84("href"), 'optionalAccess', _85 => _85.slice, 'call', _86 => _86(1), 'access', _87 => _87.trim, 'call', _88 => _88()])||null,rank:Number(_optionalChain([i, 'call', _89 => _89(r), 'access', _90 => _90.find, 'call', _91 => _91(".film-number span"), 'optionalAccess', _92 => _92.text, 'call', _93 => _93(), 'optionalAccess', _94 => _94.trim, 'call', _95 => _95()]))||null,name:_optionalChain([i, 'call', _96 => _96(r), 'access', _97 => _97.find, 'call', _98 => _98(".film-detail .dynamic-name"), 'optionalAccess', _99 => _99.text, 'call', _100 => _100(), 'optionalAccess', _101 => _101.trim, 'call', _102 => _102()])||null,jname:_optionalChain([i, 'call', _103 => _103(r), 'access', _104 => _104.find, 'call', _105 => _105(".film-detail .dynamic-name"), 'optionalAccess', _106 => _106.attr, 'call', _107 => _107("data-jname"), 'optionalAccess', _108 => _108.trim, 'call', _109 => _109()])||null,poster:_optionalChain([i, 'call', _110 => _110(r), 'access', _111 => _111.find, 'call', _112 => _112(".film-poster .film-poster-img"), 'optionalAccess', _113 => _113.attr, 'call', _114 => _114("data-src"), 'optionalAccess', _115 => _115.trim, 'call', _116 => _116()])||null,episodes:{sub:Number(_optionalChain([i, 'call', _117 => _117(r), 'access', _118 => _118.find, 'call', _119 => _119(".film-detail .fd-infor .tick-item.tick-sub"), 'optionalAccess', _120 => _120.text, 'call', _121 => _121(), 'optionalAccess', _122 => _122.trim, 'call', _123 => _123()]))||null,dub:Number(_optionalChain([i, 'call', _124 => _124(r), 'access', _125 => _125.find, 'call', _126 => _126(".film-detail .fd-infor .tick-item.tick-dub"), 'optionalAccess', _127 => _127.text, 'call', _128 => _128(), 'optionalAccess', _129 => _129.trim, 'call', _130 => _130()]))||null}})}),a}catch(a){throw d.wrapError(a,e)}},b=(i,t,e)=>{try{let a=[];return i(t).each((n,o)=>{a.push({id:_optionalChain([i, 'call', _131 => _131(o), 'access', _132 => _132.find, 'call', _133 => _133(".film-detail .dynamic-name"), 'optionalAccess', _134 => _134.attr, 'call', _135 => _135("href"), 'optionalAccess', _136 => _136.slice, 'call', _137 => _137(1), 'access', _138 => _138.trim, 'call', _139 => _139()])||null,name:_optionalChain([i, 'call', _140 => _140(o), 'access', _141 => _141.find, 'call', _142 => _142(".film-detail .dynamic-name"), 'optionalAccess', _143 => _143.text, 'call', _144 => _144(), 'optionalAccess', _145 => _145.trim, 'call', _146 => _146()])||null,jname:_optionalChain([i, 'call', _147 => _147(o), 'access', _148 => _148.find, 'call', _149 => _149(".film-detail .film-name .dynamic-name"), 'access', _150 => _150.attr, 'call', _151 => _151("data-jname"), 'optionalAccess', _152 => _152.trim, 'call', _153 => _153()])||null,poster:_optionalChain([i, 'call', _154 => _154(o), 'access', _155 => _155.find, 'call', _156 => _156(".film-poster .film-poster-img"), 'optionalAccess', _157 => _157.attr, 'call', _158 => _158("data-src"), 'optionalAccess', _159 => _159.trim, 'call', _160 => _160()])||null,episodes:{sub:Number(_optionalChain([i, 'call', _161 => _161(o), 'optionalAccess', _162 => _162.find, 'call', _163 => _163(".fd-infor .tick .tick-sub"), 'optionalAccess', _164 => _164.text, 'call', _165 => _165(), 'optionalAccess', _166 => _166.trim, 'call', _167 => _167()]))||null,dub:Number(_optionalChain([i, 'call', _168 => _168(o), 'optionalAccess', _169 => _169.find, 'call', _170 => _170(".fd-infor .tick .tick-dub"), 'optionalAccess', _171 => _171.text, 'call', _172 => _172(), 'optionalAccess', _173 => _173.trim, 'call', _174 => _174()]))||null},type:_optionalChain([i, 'call', _175 => _175(o), 'optionalAccess', _176 => _176.find, 'call', _177 => _177(".fd-infor .tick"), 'optionalAccess', _178 => _178.text, 'call', _179 => _179(), 'optionalAccess', _180 => _180.trim, 'call', _181 => _181(), 'optionalAccess', _182 => _182.replace, 'call', _183 => _183(/[\s\n]+/g," "), 'optionalAccess', _184 => _184.split, 'call', _185 => _185(" "), 'optionalAccess', _186 => _186.pop, 'call', _187 => _187()])||null})}),a}catch(a){throw d.wrapError(a,e)}};function $(i,t,e){return _optionalChain([i, 'call', _188 => _188(`.ps_-block.ps_-block-sub.servers-${e} > .ps__-list .server-item`), 'optionalAccess', _189 => _189.map, 'call', _190 => _190((a,n)=>i(n).attr("data-server-id")==`${t}`?i(n):null), 'optionalAccess', _191 => _191.get, 'call', _192 => _192(), 'access', _193 => _193[0], 'optionalAccess', _194 => _194.attr, 'call', _195 => _195("data-id")])||null}function Re(i){if(!(i.length<1))return i.map(t=>te[t]).join(",")}function me(i,t){if(t=t.trim(),!!t)switch(i){case"genres":return Re(t.split(","));case"type":{let e=_nullishCoalesce(re[t], () => (0));return e===0?void 0:`${e}`}case"status":{let e=_nullishCoalesce(ie[t], () => (0));return e===0?void 0:`${e}`}case"rated":{let e=_nullishCoalesce(ne[t], () => (0));return e===0?void 0:`${e}`}case"score":{let e=_nullishCoalesce(ae[t], () => (0));return e===0?void 0:`${e}`}case"season":{let e=_nullishCoalesce(oe[t], () => (0));return e===0?void 0:`${e}`}case"language":{let e=_nullishCoalesce(se[t], () => (0));return e===0?void 0:`${e}`}case"sort":return _nullishCoalesce(ce[t], () => (void 0));default:return}}function le(i,t){if(t=t.trim(),!t)return;let e=/^\d{4}-([0-9]|1[0-2])-([0-9]|[12][0-9]|3[01])$/,a=i?"s":"e",[n,o,r]=t.split("-");if(e.test(t))return[Number(n)>0?`${a}y=${n}`:"",Number(o)>0?`${a}m=${o}`:"",Number(r)>0?`${a}d=${r}`:""].filter(s=>!!s)}function pe(i,t){let e=i.indexOf(t);return e==-1?"":i.substring(e+t.length)}function de(i,t){let e=i.indexOf(t);return e==-1?"":i.substring(0,e)}async function U(i,t={}){let e={anime:{info:{id:null,anilistId:null,malId:null,name:null,poster:null,description:null,stats:{rating:null,quality:null,episodes:{sub:null,dub:null},type:null,duration:null},promotionalVideos:[],charactersVoiceActors:[]},moreInfo:{}},seasons:[],mostPopularAnimes:[],relatedAnimes:[],recommendedAnimes:[]};if(i.trim()===""||i.indexOf("-")===-1)throw new d("invalid anime id",U.name);try{let a=new URL(i,A),o=await y(t).get(a.href),r=_cheerio.load.call(void 0, o.data);try{let c=JSON.parse(_optionalChain([r, 'call', _196 => _196("body"), 'optionalAccess', _197 => _197.find, 'call', _198 => _198("#syncData"), 'optionalAccess', _199 => _199.text, 'call', _200 => _200()]));e.anime.info.anilistId=_optionalChain([c, 'optionalAccess', _201 => _201.anilist_id])?Number(_optionalChain([c, 'optionalAccess', _202 => _202.anilist_id])):null,e.anime.info.malId=_optionalChain([c, 'optionalAccess', _203 => _203.mal_id])?Number(_optionalChain([c, 'optionalAccess', _204 => _204.mal_id])):null}catch (e2){e.anime.info.anilistId=null,e.anime.info.malId=null}let s="#ani_detail .container .anis-content";e.anime.info.id=_optionalChain([r, 'call', _205 => _205(s), 'optionalAccess', _206 => _206.find, 'call', _207 => _207(".anisc-detail .film-buttons a.btn-play"), 'optionalAccess', _208 => _208.attr, 'call', _209 => _209("href"), 'optionalAccess', _210 => _210.split, 'call', _211 => _211("/"), 'optionalAccess', _212 => _212.pop, 'call', _213 => _213()])||null,e.anime.info.name=_optionalChain([r, 'call', _214 => _214(s), 'optionalAccess', _215 => _215.find, 'call', _216 => _216(".anisc-detail .film-name.dynamic-name"), 'optionalAccess', _217 => _217.text, 'call', _218 => _218(), 'optionalAccess', _219 => _219.trim, 'call', _220 => _220()])||null,e.anime.info.description=_optionalChain([r, 'call', _221 => _221(s), 'optionalAccess', _222 => _222.find, 'call', _223 => _223(".anisc-detail .film-description .text"), 'access', _224 => _224.text, 'call', _225 => _225(), 'optionalAccess', _226 => _226.split, 'call', _227 => _227("["), 'optionalAccess', _228 => _228.shift, 'call', _229 => _229(), 'optionalAccess', _230 => _230.trim, 'call', _231 => _231()])||null,e.anime.info.poster=_optionalChain([r, 'call', _232 => _232(s), 'optionalAccess', _233 => _233.find, 'call', _234 => _234(".film-poster .film-poster-img"), 'optionalAccess', _235 => _235.attr, 'call', _236 => _236("src"), 'optionalAccess', _237 => _237.trim, 'call', _238 => _238()])||null,e.anime.info.stats.rating=_optionalChain([r, 'call', _239 => _239(`${s} .film-stats .tick .tick-pg`), 'optionalAccess', _240 => _240.text, 'call', _241 => _241(), 'optionalAccess', _242 => _242.trim, 'call', _243 => _243()])||null,e.anime.info.stats.quality=_optionalChain([r, 'call', _244 => _244(`${s} .film-stats .tick .tick-quality`), 'optionalAccess', _245 => _245.text, 'call', _246 => _246(), 'optionalAccess', _247 => _247.trim, 'call', _248 => _248()])||null,e.anime.info.stats.episodes={sub:Number(_optionalChain([r, 'call', _249 => _249(`${s} .film-stats .tick .tick-sub`), 'optionalAccess', _250 => _250.text, 'call', _251 => _251(), 'optionalAccess', _252 => _252.trim, 'call', _253 => _253()]))||null,dub:Number(_optionalChain([r, 'call', _254 => _254(`${s} .film-stats .tick .tick-dub`), 'optionalAccess', _255 => _255.text, 'call', _256 => _256(), 'optionalAccess', _257 => _257.trim, 'call', _258 => _258()]))||null},e.anime.info.stats.type=_optionalChain([r, 'call', _259 => _259(`${s} .film-stats .tick`), 'optionalAccess', _260 => _260.text, 'call', _261 => _261(), 'optionalAccess', _262 => _262.trim, 'call', _263 => _263(), 'optionalAccess', _264 => _264.match, 'call', _265 => _265(/(TV|OVA|Movie|ONA|Special)/g), 'optionalAccess', _266 => _266[0]])||null,e.anime.info.stats.duration=_optionalChain([r, 'call', _267 => _267(`${s} .film-stats .tick`), 'optionalAccess', _268 => _268.text, 'call', _269 => _269(), 'optionalAccess', _270 => _270.trim, 'call', _271 => _271(), 'optionalAccess', _272 => _272.match, 'call', _273 => _273(/((:?[0-9]{0,2}h )?[0-9]{0,2}m)/g), 'optionalAccess', _274 => _274[0]])||null,r(".block_area.block_area-promotions .block_area-promotions-list .screen-items .item").each((c,l)=>{e.anime.info.promotionalVideos.push({title:r(l).attr("data-title"),source:r(l).attr("data-src"),thumbnail:r(l).find("img").attr("src")})}),r(".block_area.block_area-actors .block-actors-content .bac-list-wrap .bac-item").each((c,l)=>{e.anime.info.charactersVoiceActors.push({character:{id:_optionalChain([r, 'call', _275 => _275(l), 'access', _276 => _276.find, 'call', _277 => _277(r(".per-info.ltr .pi-avatar")), 'access', _278 => _278.attr, 'call', _279 => _279("href"), 'optionalAccess', _280 => _280.split, 'call', _281 => _281("/"), 'access', _282 => _282[2]])||"",poster:r(l).find(r(".per-info.ltr .pi-avatar img")).attr("data-src")||"",name:r(l).find(r(".per-info.ltr .pi-detail a")).text(),cast:r(l).find(r(".per-info.ltr .pi-detail .pi-cast")).text()},voiceActor:{id:_optionalChain([r, 'call', _283 => _283(l), 'access', _284 => _284.find, 'call', _285 => _285(r(".per-info.rtl .pi-avatar")), 'access', _286 => _286.attr, 'call', _287 => _287("href"), 'optionalAccess', _288 => _288.split, 'call', _289 => _289("/"), 'access', _290 => _290[2]])||"",poster:r(l).find(r(".per-info.rtl .pi-avatar img")).attr("data-src")||"",name:r(l).find(r(".per-info.rtl .pi-detail a")).text(),cast:r(l).find(r(".per-info.rtl .pi-detail .pi-cast")).text()}})}),r(`${s} .anisc-info-wrap .anisc-info .item:not(.w-hide)`).each((c,l)=>{let f=r(l).find(".item-head").text().toLowerCase().replace(":","").trim();f=f.includes(" ")?f.replace(" ",""):f;let E=[...r(l).find("*:not(.item-head)").map((w,x)=>r(x).text().trim())].map(w=>`${w}`).toString().trim();if(["studios","genres","producers"].includes(f)){e.anime.moreInfo[f]=E.split(",").map(w=>w.trim());return}e.anime.moreInfo[f]=E}),r("#main-content .os-list a.os-item").each((c,l)=>{e.seasons.push({id:_optionalChain([r, 'call', _291 => _291(l), 'optionalAccess', _292 => _292.attr, 'call', _293 => _293("href"), 'optionalAccess', _294 => _294.slice, 'call', _295 => _295(1), 'optionalAccess', _296 => _296.trim, 'call', _297 => _297()])||null,name:_optionalChain([r, 'call', _298 => _298(l), 'optionalAccess', _299 => _299.attr, 'call', _300 => _300("title"), 'optionalAccess', _301 => _301.trim, 'call', _302 => _302()])||null,title:_optionalChain([r, 'call', _303 => _303(l), 'optionalAccess', _304 => _304.find, 'call', _305 => _305(".title"), 'optionalAccess', _306 => _306.text, 'call', _307 => _307(), 'optionalAccess', _308 => _308.trim, 'call', _309 => _309()]),poster:_optionalChain([r, 'call', _310 => _310(l), 'optionalAccess', _311 => _311.find, 'call', _312 => _312(".season-poster"), 'optionalAccess', _313 => _313.attr, 'call', _314 => _314("style"), 'optionalAccess', _315 => _315.split, 'call', _316 => _316(" "), 'optionalAccess', _317 => _317.pop, 'call', _318 => _318(), 'optionalAccess', _319 => _319.split, 'call', _320 => _320("("), 'optionalAccess', _321 => _321.pop, 'call', _322 => _322(), 'optionalAccess', _323 => _323.split, 'call', _324 => _324(")"), 'access', _325 => _325[0]])||null,isCurrent:r(l).hasClass("active")})});let p="#main-sidebar .block_area.block_area_sidebar.block_area-realtime:nth-of-type(1) .anif-block-ul ul li";e.relatedAnimes=b(r,p,U.name);let h="#main-sidebar .block_area.block_area_sidebar.block_area-realtime:nth-of-type(2) .anif-block-ul ul li";e.mostPopularAnimes=b(r,h,U.name);let u="#main-content .block_area.block_area_category .tab-content .flw-item";return e.recommendedAnimes=S(r,u,U.name),e}catch(a){throw d.wrapError(a,U.name)}}async function I(i,t=1,e={}){let a={animes:[],genres:[],top10Animes:{today:[],week:[],month:[]},category:i,totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};try{if(i.trim()==="")throw new d("invalid anime category",I.name);t=t<1?1:t;let n=new URL(i,A),r=await y(e).get(`${n}?page=${t}`),s=_cheerio.load.call(void 0, r.data),m="#main-content .tab-content .film_list-wrap .flw-item",p="#main-content .block_area .block_area-header .cat-heading";return a.category=_nullishCoalesce(_optionalChain([s, 'call', _326 => _326(p), 'optionalAccess', _327 => _327.text, 'call', _328 => _328(), 'optionalAccess', _329 => _329.trim, 'call', _330 => _330()]), () => (i)),a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(_nullishCoalesce(_nullishCoalesce(_optionalChain([s, 'call', _331 => _331('.pagination > .page-item a[title="Last"]'), 'optionalAccess', _332 => _332.attr, 'call', _333 => _333("href"), 'optionalAccess', _334 => _334.split, 'call', _335 => _335("="), 'access', _336 => _336.pop, 'call', _337 => _337()]), () => (_optionalChain([s, 'call', _338 => _338('.pagination > .page-item a[title="Next"]'), 'optionalAccess', _339 => _339.attr, 'call', _340 => _340("href"), 'optionalAccess', _341 => _341.split, 'call', _342 => _342("="), 'access', _343 => _343.pop, 'call', _344 => _344()]))), () => (_optionalChain([s, 'call', _345 => _345(".pagination > .page-item.active a"), 'optionalAccess', _346 => _346.text, 'call', _347 => _347(), 'optionalAccess', _348 => _348.trim, 'call', _349 => _349()]))))||1,a.animes=S(s,m,I.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0),s("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((c,l)=>{a.genres.push(`${s(l).text().trim()}`)}),s('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((c,l)=>{let f=_optionalChain([s, 'call', _350 => _350(l), 'access', _351 => _351.attr, 'call', _352 => _352("id"), 'optionalAccess', _353 => _353.split, 'call', _354 => _354("-"), 'optionalAccess', _355 => _355.pop, 'call', _356 => _356(), 'optionalAccess', _357 => _357.trim, 'call', _358 => _358()]);if(f==="day"){a.top10Animes.today=_(s,f,I.name);return}if(f==="week"){a.top10Animes.week=_(s,f,I.name);return}f==="month"&&(a.top10Animes.month=_(s,f,I.name))}),a}catch(n){throw d.wrapError(n,I.name)}}async function H(i,t={}){let e={totalEpisodes:0,episodes:[]};try{if(i.trim()===""||i.indexOf("-")===-1)throw new d("invalid anime id",H.name);let n=await y(t).get(`${R}/v2/episode/list/${i.split("-").pop()}`,{headers:{"X-Requested-With":"XMLHttpRequest",Referer:`${A}/watch/${i}`}}),o=_cheerio.load.call(void 0, n.data.html);return e.totalEpisodes=Number(o(".detail-infor-content .ss-list a").length),o(".detail-infor-content .ss-list a").each((r,s)=>{e.episodes.push({title:_optionalChain([o, 'call', _359 => _359(s), 'optionalAccess', _360 => _360.attr, 'call', _361 => _361("title"), 'optionalAccess', _362 => _362.trim, 'call', _363 => _363()])||null,episodeId:_optionalChain([o, 'call', _364 => _364(s), 'optionalAccess', _365 => _365.attr, 'call', _366 => _366("href"), 'optionalAccess', _367 => _367.split, 'call', _368 => _368("/"), 'optionalAccess', _369 => _369.pop, 'call', _370 => _370()])||null,number:Number(o(s).attr("data-number")),isFiller:o(s).hasClass("ssl-item-filler")})}),e}catch(a){throw d.wrapError(a,H.name)}}var _crypto = require('crypto'); var _crypto2 = _interopRequireDefault(_crypto);var he={script:"https://megacloud.tv/js/player/a/prod/e1-player.min.js?v=",sources:"https://megacloud.tv/embed-2/ajax/e-1/getSources?id="},O=class{async extract(t){try{let e={tracks:[],intro:{start:0,end:0},outro:{start:0,end:0},sources:[]},a=_optionalChain([t, 'optionalAccess', _371 => _371.href, 'optionalAccess', _372 => _372.split, 'call', _373 => _373("/"), 'optionalAccess', _374 => _374.pop, 'call', _375 => _375(), 'optionalAccess', _376 => _376.split, 'call', _377 => _377("?"), 'access', _378 => _378[0]]),{data:n}=await _axios2.default.get(he.sources.concat(a||""),{headers:{Accept:"*/*","X-Requested-With":"XMLHttpRequest","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Referer:t.href}});if(!n)throw new d("Url may have an invalid video id","getAnimeEpisodeSources");let o=n.sources;if(!n.encrypted&&Array.isArray(o))return e.intro=n.intro,e.outro=n.outro,e.tracks=n.tracks,e.sources=o.map(c=>({url:c.file,type:c.type})),e;let r,{data:s}=await _axios2.default.get(he.script.concat(Date.now().toString()));if(r=s,!r)throw new d("Couldn't fetch script to decrypt resource","getAnimeEpisodeSources");let m=this.extractVariables(r);if(!m.length)throw new Error("Can't find variables. Perhaps the extractor is outdated.");let{secret:p,encryptedSource:h}=this.getSecret(o,m),u=this.decrypt(h,p);try{let c=JSON.parse(u);return e.intro=n.intro,e.outro=n.outro,e.tracks=n.tracks,e.sources=c.map(l=>({url:l.file,type:l.type})),e}catch (e3){throw new d("Failed to decrypt resource","getAnimeEpisodeSources")}}catch(e){throw e}}extractVariables(t){let e=/case\s*0x[0-9a-f]+:(?![^;]*=partKey)\s*\w+\s*=\s*(\w+)\s*,\s*\w+\s*=\s*(\w+);/g,a=t.matchAll(e);return Array.from(a,o=>{let r=this.matchingKey(o[1],t),s=this.matchingKey(o[2],t);try{return[parseInt(r,16),parseInt(s,16)]}catch (e4){return[]}}).filter(o=>o.length>0)}getSecret(t,e){let a="",n="",o=t.split(""),r=0;for(let s of e){let m=s[0]+r,p=m+s[1];for(let h=m;h<p;h++)a+=t[h],o[h]="";r+=s[1]}return n=o.join(""),{secret:a,encryptedSource:n}}decrypt(t,e,a){let n,o,r;if(a)n=e,o=a,r=t;else{let p=Buffer.from(t,"base64"),h=p.subarray(8,16),u=Buffer.concat([Buffer.from(e,"binary"),h]),c=[],l=u;for(let f=0;f<3;f++)c[f]=_crypto2.default.createHash("md5").update(l).digest(),l=Buffer.concat([c[f],u]);n=Buffer.concat([c[0],c[1]]),o=c[2],r=p.subarray(16)}let s=_crypto2.default.createDecipheriv("aes-256-cbc",n,o);return s.update(r,typeof r=="string"?"base64":void 0,"utf8")+s.final()}matchingKey(t,e){let a=new RegExp(`,${t}=((?:0x)?([0-9a-fA-F]+))`),n=e.match(a);if(n)return n[1].replace(/^0x/,"");throw new Error("Failed to match the key")}},F=O;var _cryptojs = require('crypto-js'); var _cryptojs2 = _interopRequireDefault(_cryptojs);var V= (_class =class{constructor() { _class.prototype.__init.call(this);_class.prototype.__init2.call(this);_class.prototype.__init3.call(this); }__init() {this.sources=[]}__init2() {this.fallbackKey="c1d17096f2ca11b7"}__init3() {this.host="https://rapid-cloud.co"}async extract(t){let e={sources:[],subtitles:[]};try{let a=_optionalChain([t, 'access', _379 => _379.href, 'access', _380 => _380.split, 'call', _381 => _381("/"), 'access', _382 => _382.pop, 'call', _383 => _383(), 'optionalAccess', _384 => _384.split, 'call', _385 => _385("?"), 'access', _386 => _386[0]]),n={headers:{"X-Requested-With":"XMLHttpRequest"}},o=null;o=await _axios2.default.get(`https://${t.hostname}/embed-2/ajax/e-1/getSources?id=${a}`,n);let{data:{sources:r,tracks:s,intro:m,outro:p,encrypted:h}}=o,u=await(await _axios2.default.get("https://raw.githubusercontent.com/cinemaxhq/keys/e1/key")).data;u=de(pe(u,'"blob-code blob-code-inner js-file-line">'),"</td>"),u||(u=await(await _axios2.default.get("https://raw.githubusercontent.com/cinemaxhq/keys/e1/key")).data),u||(u=this.fallbackKey);try{if(h){let c=r.split(""),l="",f=0;for(let w of u){let x=w[0]+f,P=x+w[1];for(let T=x;T<P;T++)l+=o.data.sources[T],c[T]="";f+=w[1]}u=l,r=c.join("");let E=_cryptojs2.default.AES.decrypt(r,u);r=JSON.parse(E.toString(_cryptojs2.default.enc.Utf8))}}catch(c){throw console.log(c.message),new Error("Cannot decrypt sources. Perhaps the key is invalid.")}if(this.sources=_optionalChain([r, 'optionalAccess', _387 => _387.map, 'call', _388 => _388(c=>({url:c.file,isM3U8:c.file.includes(".m3u8")}))]),e.sources.push(...this.sources),t.href.includes(new URL(this.host).host)){e.sources=[],this.sources=[];for(let c of r){let{data:l}=await _axios2.default.get(c.file,n),w=l.split(`
`).filter(x=>x.includes(".m3u8")&&x.includes("RESOLUTION=")).map(x=>_optionalChain([x, 'access', _389 => _389.match, 'call', _390 => _390(/RESOLUTION=.*,(C)|URI=.*/g), 'optionalAccess', _391 => _391.map, 'call', _392 => _392(P=>P.split("=")[1])])).map(x=>{let P=x[0].split(",C")[0],T=x[1].replace(/"/g,"");return[P,T]});for(let[x,P]of w)this.sources.push({url:`${_optionalChain([c, 'access', _393 => _393.file, 'optionalAccess', _394 => _394.split, 'call', _395 => _395("master.m3u8"), 'access', _396 => _396[0]])}${P.replace("iframes","index")}`,quality:x.split("x")[1]+"p",isM3U8:P.includes(".m3u8")});e.sources.push(...this.sources)}}return e.intro=_optionalChain([m, 'optionalAccess', _397 => _397.end])>1?{start:m.start,end:m.end}:void 0,e.outro=_optionalChain([p, 'optionalAccess', _398 => _398.end])>1?{start:p.start,end:p.end}:void 0,e.sources.push({url:r[0].file,isM3U8:r[0].file.includes(".m3u8"),quality:"auto"}),e.subtitles=s.map(c=>c.file?{url:c.file,lang:c.label?c.label:"Thumbnails"}:null).filter(c=>c),e}catch(a){throw console.log(a.message),a}}}, _class),X=V;var B= (_class2 =class{constructor() { _class2.prototype.__init4.call(this);_class2.prototype.__init5.call(this);_class2.prototype.__init6.call(this); }__init4() {this.sources=[]}__init5() {this.host="https://watchsb.com/sources50"}__init6() {this.host2="https://streamsss.net/sources16"}PAYLOAD(t){return`566d337678566f743674494a7c7c${t}7c7c346b6767586d6934774855537c7c73747265616d7362/6565417268755339773461447c7c346133383438333436313335376136323337373433383634376337633465366534393338373136643732373736343735373237613763376334363733353737303533366236333463353333363534366137633763373337343732363536313664373336327c7c6b586c3163614468645a47617c7c73747265616d7362`}async extract(t,e=!1){let a={watchsb:"sbstream",Referer:t.href,"User-Agent":k},n=t.href.split("/e/").pop();_optionalChain([n, 'optionalAccess', _399 => _399.includes, 'call', _400 => _400("html")])&&(n=n.split(".html")[0]);let o=new TextEncoder().encode(n),r=await _axios2.default.get(`${e?this.host2:this.host}/${this.PAYLOAD(Buffer.from(o).toString("hex"))}`,{headers:a}).catch(()=>null);if(!_optionalChain([r, 'optionalAccess', _401 => _401.data, 'access', _402 => _402.stream_data]))throw new Error("No source found. Try a different server");a={"User-Agent":k,Referer:t.href.split("e/")[0]};let m=await _asyncNullishCoalesce(await _asyncOptionalChain([(await _axios2.default.get(r.data.stream_data.file,{headers:a})), 'optionalAccess', async _403 => _403.data, 'optionalAccess', async _404 => _404.split, 'call', async _405 => _405("#EXT-X-STREAM-INF:")]), async () => ([]));for(let p of m){if(!p.includes("m3u8"))continue;let h=p.split(`
`)[1],u=p.split("RESOLUTION=")[1].split(",")[0].split("x")[1];this.sources.push({url:h,quality:`${u}p`,isM3U8:!0})}return this.sources.push({url:r.data.stream_data.file,quality:"auto",isM3U8:r.data.stream_data.file.includes(".m3u8")}),this.sources}}, _class2),K=B;var G= (_class3 =class{constructor() { _class3.prototype.__init7.call(this); }__init7() {this.sources=[]}async extract(t){try{let{data:e}=await _axios2.default.get(t.href).catch(()=>{throw new Error("Video not found")}),a=_cheerio.load.call(void 0, e),[n,o]=_optionalChain([a, 'access', _406 => _406.html, 'call', _407 => _407(), 'optionalAccess', _408 => _408.match, 'call', _409 => _409(/robotlink'\).innerHTML = (.*)'/), 'access', _410 => _410[1], 'access', _411 => _411.split, 'call', _412 => _412("+ ('")]);o=o.substring(3),n=n.replace(/\'/g,"");let r=`https:${n}${o}`;return this.sources.push({url:r,isM3U8:r.includes(".m3u8")}),this.sources}catch(e){throw new Error(e.message)}}}, _class3),W=G;async function xe(i,t="hd-1",e="sub",a={}){if(i.startsWith("http")){let o=new URL(i);switch(t){case"hd-1":case"hd-2":return{...await new F().extract(o)};case"streamsb":return{headers:{Referer:o.href,watchsb:"streamsb","User-Agent":k},sources:await new K().extract(o,!0)};case"streamtape":return{headers:{Referer:o.href,"User-Agent":k},sources:await new W().extract(o)};default:return{headers:{Referer:o.href},...await new X().extract(o)}}}let n=new URL(`/watch/${i}`,A).href;console.log("EPISODE_ID: ",n);try{let o=y(a),r=await o.get(`${R}/v2/episode/servers?episodeId=${n.split("?ep=")[1]}`,{headers:{Referer:n,"X-Requested-With":"XMLHttpRequest"}}),s=_cheerio.load.call(void 0, r.data.html),m=null;try{switch(console.log("THE SERVER: ",t),t){case"hd-2":{if(m=$(s,1,e),!m)throw new Error("RapidCloud not found");break}case"hd-1":{if(m=$(s,4,e),console.log("SERVER_ID: ",m),!m)throw new Error("VidStreaming not found");break}case"streamsb":{if(m=$(s,5,e),!m)throw new Error("StreamSB not found");break}case"streamtape":{if(m=$(s,3,e),!m)throw new Error("StreamTape not found");break}}}catch (e5){throw new d("Couldn't find server. Try another server",L.name)}let{data:{link:p}}=await o.get(`${R}/v2/episode/sources?id=${m}`);return console.log("THE LINK: ",p),await xe(p,t)}catch(o){throw d.wrapError(o,L.name)}}async function L(i,t="hd-1",e="sub"){try{if(i===""||i.indexOf("?ep=")===-1)throw new d("invalid anime episode id",L.name);if(e.trim()==="")throw new d("invalid anime episode category",L.name);let a,n,o=_optionalChain([new URL(_optionalChain([i, 'optionalAccess', _413 => _413.split, 'call', _414 => _414("?ep="), 'access', _415 => _415[0]]),A), 'optionalAccess', _416 => _416.href]),[r,s]=await Promise.all([xe(i,t,e),_axios2.default.get(o,{headers:{Referer:A,"User-Agent":k,"X-Requested-With":"XMLHttpRequest"}})]),m=_cheerio.load.call(void 0, _optionalChain([s, 'optionalAccess', _417 => _417.data]));try{n=Number(_optionalChain([JSON, 'access', _418 => _418.parse, 'call', _419 => _419(_optionalChain([m, 'call', _420 => _420("body"), 'optionalAccess', _421 => _421.find, 'call', _422 => _422("#syncData"), 'optionalAccess', _423 => _423.text, 'call', _424 => _424()])), 'optionalAccess', _425 => _425.anilist_id])),a=Number(_optionalChain([JSON, 'access', _426 => _426.parse, 'call', _427 => _427(_optionalChain([m, 'call', _428 => _428("body"), 'optionalAccess', _429 => _429.find, 'call', _430 => _430("#syncData"), 'optionalAccess', _431 => _431.text, 'call', _432 => _432()])), 'optionalAccess', _433 => _433.mal_id]))}catch (e6){n=null,a=null}return{...r,anilistID:n,malID:a}}catch(a){throw d.wrapError(a,L.name)}}async function j(i,t=1,e={}){let a={genreName:i,animes:[],genres:[],topAiringAnimes:[],totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};i=i==="martial-arts"?"marial-arts":i;try{if(i.trim()==="")throw new d("invalid genre name",j.name);t=t<1?1:t;let n=new URL(`/genre/${i}?page=${t}`,A),r=await y(e).get(n.href),s=_cheerio.load.call(void 0, r.data),m="#main-content .tab-content .film_list-wrap .flw-item",p="#main-content .block_area .block_area-header .cat-heading";a.genreName=_nullishCoalesce(_optionalChain([s, 'call', _434 => _434(p), 'optionalAccess', _435 => _435.text, 'call', _436 => _436(), 'optionalAccess', _437 => _437.trim, 'call', _438 => _438()]), () => (i)),a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(_nullishCoalesce(_nullishCoalesce(_optionalChain([s, 'call', _439 => _439('.pagination > .page-item a[title="Last"]'), 'optionalAccess', _440 => _440.attr, 'call', _441 => _441("href"), 'optionalAccess', _442 => _442.split, 'call', _443 => _443("="), 'access', _444 => _444.pop, 'call', _445 => _445()]), () => (_optionalChain([s, 'call', _446 => _446('.pagination > .page-item a[title="Next"]'), 'optionalAccess', _447 => _447.attr, 'call', _448 => _448("href"), 'optionalAccess', _449 => _449.split, 'call', _450 => _450("="), 'access', _451 => _451.pop, 'call', _452 => _452()]))), () => (_optionalChain([s, 'call', _453 => _453(".pagination > .page-item.active a"), 'optionalAccess', _454 => _454.text, 'call', _455 => _455(), 'optionalAccess', _456 => _456.trim, 'call', _457 => _457()]))))||1,a.animes=S(s,m,j.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0),s("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((c,l)=>{a.genres.push(`${s(l).text().trim()}`)});let u="#main-sidebar .block_area.block_area_sidebar.block_area-realtime .anif-block-ul ul li";return a.topAiringAnimes=b(s,u,j.name),a}catch(n){throw d.wrapError(n,j.name)}}async function v(i,t=1,e={}){let a={producerName:i,animes:[],top10Animes:{today:[],week:[],month:[]},topAiringAnimes:[],totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};try{if(i.trim()==="")throw new d("invalid producer name",v.name);t=t<1?1:t;let n=new URL(`/producer/${i}?page=${t}`,A),r=await y(e).get(n.href),s=_cheerio.load.call(void 0, r.data),m="#main-content .tab-content .film_list-wrap .flw-item";a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(_nullishCoalesce(_nullishCoalesce(_optionalChain([s, 'call', _458 => _458('.pagination > .page-item a[title="Last"]'), 'optionalAccess', _459 => _459.attr, 'call', _460 => _460("href"), 'optionalAccess', _461 => _461.split, 'call', _462 => _462("="), 'access', _463 => _463.pop, 'call', _464 => _464()]), () => (_optionalChain([s, 'call', _465 => _465('.pagination > .page-item a[title="Next"]'), 'optionalAccess', _466 => _466.attr, 'call', _467 => _467("href"), 'optionalAccess', _468 => _468.split, 'call', _469 => _469("="), 'access', _470 => _470.pop, 'call', _471 => _471()]))), () => (_optionalChain([s, 'call', _472 => _472(".pagination > .page-item.active a"), 'optionalAccess', _473 => _473.text, 'call', _474 => _474(), 'optionalAccess', _475 => _475.trim, 'call', _476 => _476()]))))||1,a.animes=S(s,m,v.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0);let p="#main-content .block_area .block_area-header .cat-heading";a.producerName=_nullishCoalesce(_optionalChain([s, 'call', _477 => _477(p), 'optionalAccess', _478 => _478.text, 'call', _479 => _479(), 'optionalAccess', _480 => _480.trim, 'call', _481 => _481()]), () => (i)),s('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((c,l)=>{let f=_optionalChain([s, 'call', _482 => _482(l), 'access', _483 => _483.attr, 'call', _484 => _484("id"), 'optionalAccess', _485 => _485.split, 'call', _486 => _486("-"), 'optionalAccess', _487 => _487.pop, 'call', _488 => _488(), 'optionalAccess', _489 => _489.trim, 'call', _490 => _490()]);if(f==="day"){a.top10Animes.today=_(s,f,v.name);return}if(f==="week"){a.top10Animes.week=_(s,f,v.name);return}f==="month"&&(a.top10Animes.month=_(s,f,v.name))});let u="#main-sidebar .block_area_sidebar:nth-child(2) .block_area-content .anif-block-ul ul li";return a.topAiringAnimes=b(s,u,v.name),a}catch(n){throw d.wrapError(n,v.name)}}var Le={filter:!0,type:!0,status:!0,rated:!0,score:!0,season:!0,language:!0,start_date:!0,end_date:!0,sort:!0,genres:!0};async function Me(i,t=1,e,a={}){try{let n={animes:[],mostPopularAnimes:[],searchQuery:i,searchFilters:e,totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)},o=new URL(ee);o.searchParams.set("keyword",i),o.searchParams.set("page",`${t}`),o.searchParams.set("sort","default");for(let u in e){if(u.includes("_date")){let l=le(u==="start_date",e[u]||"");if(!l)continue;l.map(f=>{let[E,w]=f.split("=");o.searchParams.set(E,w)});continue}let c=me(u,e[u]||"");c&&o.searchParams.set(u,c)}let s=await y(a).get(o.href),m=_cheerio.load.call(void 0, s.data),p="#main-content .tab-content .film_list-wrap .flw-item";n.hasNextPage=m(".pagination > li").length>0&&m(".pagination li.active").length>0?!m(".pagination > li").last().hasClass("active"):!1,n.totalPages=Number(_nullishCoalesce(_nullishCoalesce(_optionalChain([m, 'call', _491 => _491('.pagination > .page-item a[title="Last"]'), 'optionalAccess', _492 => _492.attr, 'call', _493 => _493("href"), 'optionalAccess', _494 => _494.split, 'call', _495 => _495("="), 'access', _496 => _496.pop, 'call', _497 => _497()]), () => (_optionalChain([m, 'call', _498 => _498('.pagination > .page-item a[title="Next"]'), 'optionalAccess', _499 => _499.attr, 'call', _500 => _500("href"), 'optionalAccess', _501 => _501.split, 'call', _502 => _502("="), 'access', _503 => _503.pop, 'call', _504 => _504()]))), () => (_optionalChain([m, 'call', _505 => _505(".pagination > .page-item.active a"), 'optionalAccess', _506 => _506.text, 'call', _507 => _507(), 'optionalAccess', _508 => _508.trim, 'call', _509 => _509()]))))||1,n.animes=S(m,p,M.name),n.animes.length===0&&!n.hasNextPage&&(n.totalPages=0);let h="#main-sidebar .block_area.block_area_sidebar.block_area-realtime .anif-block-ul ul li";return n.mostPopularAnimes=b(m,h,M.name),n}catch(n){throw d.wrapError(n,M.name)}}async function M(i,t=1,e={}){try{if(i=i.trim()?decodeURIComponent(i.trim()):"",i.trim()==="")throw new d("invalid search query",M.name);t=t<1?1:t;let a={};for(let n in e)Le[n]&&(a[n]=e[n]);return Me(i,t,a)}catch(a){throw d.wrapError(a,M.name)}}async function J(i,t={}){try{let e={suggestions:[]};if(i=i.trim()?decodeURIComponent(i.trim()):"",i.trim()==="")throw new d("invalid search query",J.name);let a=y(t),{data:n}=await a.get(`${R}/search/suggest?keyword=${encodeURIComponent(i)}`,{headers:{Accept:"*/*",Pragma:"no-cache",Referer:N,"X-Requested-With":"XMLHttpRequest"}}),o=_cheerio.load.call(void 0, n.html),r=".nav-item:has(.film-poster)";return o(r).length<1||o(r).each((s,m)=>{let p=_optionalChain([o, 'call', _510 => _510(m), 'access', _511 => _511.attr, 'call', _512 => _512("href"), 'optionalAccess', _513 => _513.split, 'call', _514 => _514("?"), 'access', _515 => _515[0], 'access', _516 => _516.includes, 'call', _517 => _517("javascript")])?null:_optionalChain([o, 'call', _518 => _518(m), 'access', _519 => _519.attr, 'call', _520 => _520("href"), 'optionalAccess', _521 => _521.split, 'call', _522 => _522("?"), 'access', _523 => _523[0], 'optionalAccess', _524 => _524.slice, 'call', _525 => _525(1)])||null;e.suggestions.push({id:p,name:_optionalChain([o, 'call', _526 => _526(m), 'access', _527 => _527.find, 'call', _528 => _528(".srp-detail .film-name"), 'optionalAccess', _529 => _529.text, 'call', _530 => _530(), 'optionalAccess', _531 => _531.trim, 'call', _532 => _532()])||null,jname:_optionalChain([o, 'call', _533 => _533(m), 'access', _534 => _534.find, 'call', _535 => _535(".srp-detail .film-name"), 'optionalAccess', _536 => _536.attr, 'call', _537 => _537("data-jname"), 'optionalAccess', _538 => _538.trim, 'call', _539 => _539()])||_optionalChain([o, 'call', _540 => _540(m), 'access', _541 => _541.find, 'call', _542 => _542(".srp-detail .alias-name"), 'optionalAccess', _543 => _543.text, 'call', _544 => _544(), 'optionalAccess', _545 => _545.trim, 'call', _546 => _546()])||null,poster:_optionalChain([o, 'call', _547 => _547(m), 'access', _548 => _548.find, 'call', _549 => _549(".film-poster .film-poster-img"), 'optionalAccess', _550 => _550.attr, 'call', _551 => _551("data-src"), 'optionalAccess', _552 => _552.trim, 'call', _553 => _553()])||null,moreInfo:[...o(m).find(".film-infor").contents().map((h,u)=>o(u).text().trim())].filter(h=>h)})}),e}catch(e){throw d.wrapError(e,J.name)}}async function z(i,t={}){let e={sub:[],dub:[],raw:[],episodeId:i,episodeNo:0};try{if(i.trim()===""||i.indexOf("?ep=")===-1)throw new d("invalid anime episode id",z.name);let a=i.split("?ep=")[1],n=y(t),{data:o}=await n.get(`${R}/v2/episode/servers?episodeId=${a}`,{headers:{"X-Requested-With":"XMLHttpRequest",Referer:new URL(`/watch/${i}`,A).href}}),r=_cheerio.load.call(void 0, o.html),s=".server-notice strong";return e.episodeNo=Number(r(s).text().split(" ").pop())||0,r(".ps_-block.ps_-block-sub.servers-sub .ps__-list .server-item").each((m,p)=>{e.sub.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(_optionalChain([r, 'call', _554 => _554(p), 'optionalAccess', _555 => _555.attr, 'call', _556 => _556("data-server-id"), 'optionalAccess', _557 => _557.trim, 'call', _558 => _558()]))||null})}),r(".ps_-block.ps_-block-sub.servers-dub .ps__-list .server-item").each((m,p)=>{e.dub.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(_optionalChain([r, 'call', _559 => _559(p), 'optionalAccess', _560 => _560.attr, 'call', _561 => _561("data-server-id"), 'optionalAccess', _562 => _562.trim, 'call', _563 => _563()]))||null})}),r(".ps_-block.ps_-block-sub.servers-raw .ps__-list .server-item").each((m,p)=>{e.raw.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(_optionalChain([r, 'call', _564 => _564(p), 'optionalAccess', _565 => _565.attr, 'call', _566 => _566("data-server-id"), 'optionalAccess', _567 => _567.trim, 'call', _568 => _568()]))||null})}),e}catch(a){throw d.wrapError(a,z.name)}}async function Y(i,t={}){let e={scheduledAnimes:[]};try{if(i=_optionalChain([i, 'optionalAccess', _569 => _569.trim, 'call', _570 => _570()]),i===""||/^\d{4}-\d{2}-\d{2}$/.test(i)===!1)throw new d("invalid date format",Y.name);let a=`${R}/schedule/list?tzOffset=-330&date=${i}`,o=await y(t).get(a,{headers:{Accept:"*/*",Referer:N,"X-Requested-With":"XMLHttpRequest"}}),r=_cheerio.load.call(void 0, _optionalChain([o, 'optionalAccess', _571 => _571.data, 'optionalAccess', _572 => _572.html])),s="li";return _optionalChain([r, 'call', _573 => _573(s), 'optionalAccess', _574 => _574.text, 'call', _575 => _575(), 'optionalAccess', _576 => _576.trim, 'call', _577 => _577(), 'optionalAccess', _578 => _578.includes, 'call', _579 => _579("No data to display")])||r(s).each((m,p)=>{let h=new Date(`${i}T${_optionalChain([r, 'call', _580 => _580(p), 'optionalAccess', _581 => _581.find, 'call', _582 => _582("a .time"), 'optionalAccess', _583 => _583.text, 'call', _584 => _584(), 'optionalAccess', _585 => _585.trim, 'call', _586 => _586()])}:00`).getTime();e.scheduledAnimes.push({id:_optionalChain([r, 'call', _587 => _587(p), 'optionalAccess', _588 => _588.find, 'call', _589 => _589("a"), 'optionalAccess', _590 => _590.attr, 'call', _591 => _591("href"), 'optionalAccess', _592 => _592.slice, 'call', _593 => _593(1), 'optionalAccess', _594 => _594.trim, 'call', _595 => _595()])||null,time:_optionalChain([r, 'call', _596 => _596(p), 'optionalAccess', _597 => _597.find, 'call', _598 => _598("a .time"), 'optionalAccess', _599 => _599.text, 'call', _600 => _600(), 'optionalAccess', _601 => _601.trim, 'call', _602 => _602()])||null,name:_optionalChain([r, 'call', _603 => _603(p), 'optionalAccess', _604 => _604.find, 'call', _605 => _605("a .film-name.dynamic-name"), 'optionalAccess', _606 => _606.text, 'call', _607 => _607(), 'optionalAccess', _608 => _608.trim, 'call', _609 => _609()])||null,jname:_optionalChain([r, 'call', _610 => _610(p), 'optionalAccess', _611 => _611.find, 'call', _612 => _612("a .film-name.dynamic-name"), 'optionalAccess', _613 => _613.attr, 'call', _614 => _614("data-jname"), 'optionalAccess', _615 => _615.trim, 'call', _616 => _616()])||null,airingTimestamp:h,secondsUntilAiring:Math.floor((h-Date.now())/1e3),episode:Number(r(p).find("a .fd-play button").text().trim().split(" ")[1])})}),e}catch(a){throw d.wrapError(a,Y.name)}}async function C(i={}){let t={spotlightAnimes:[],trendingAnimes:[],latestEpisodeAnimes:[],topUpcomingAnimes:[],top10Animes:{today:[],week:[],month:[]},topAiringAnimes:[],mostPopularAnimes:[],mostFavoriteAnimes:[],latestCompletedAnimes:[],genres:[]};try{let a=await y(i).get(N),n=_cheerio.load.call(void 0, a.data);n("#slider .swiper-wrapper .swiper-slide").each((u,c)=>{let l=n(c).find(".deslide-item-content .sc-detail .scd-item").map((f,E)=>n(E).text().trim()).get().slice(0,-1);t.spotlightAnimes.push({rank:Number(_optionalChain([n, 'call', _617 => _617(c), 'access', _618 => _618.find, 'call', _619 => _619(".deslide-item-content .desi-sub-text"), 'optionalAccess', _620 => _620.text, 'call', _621 => _621(), 'access', _622 => _622.trim, 'call', _623 => _623(), 'access', _624 => _624.split, 'call', _625 => _625(" "), 'access', _626 => _626[0], 'access', _627 => _627.slice, 'call', _628 => _628(1)]))||null,id:_optionalChain([n, 'call', _629 => _629(c), 'access', _630 => _630.find, 'call', _631 => _631(".deslide-item-content .desi-buttons a"), 'optionalAccess', _632 => _632.last, 'call', _633 => _633(), 'optionalAccess', _634 => _634.attr, 'call', _635 => _635("href"), 'optionalAccess', _636 => _636.slice, 'call', _637 => _637(1), 'optionalAccess', _638 => _638.trim, 'call', _639 => _639()])||null,name:_optionalChain([n, 'call', _640 => _640(c), 'access', _641 => _641.find, 'call', _642 => _642(".deslide-item-content .desi-head-title.dynamic-name"), 'optionalAccess', _643 => _643.text, 'call', _644 => _644(), 'access', _645 => _645.trim, 'call', _646 => _646()]),description:_optionalChain([n, 'call', _647 => _647(c), 'access', _648 => _648.find, 'call', _649 => _649(".deslide-item-content .desi-description"), 'optionalAccess', _650 => _650.text, 'call', _651 => _651(), 'optionalAccess', _652 => _652.split, 'call', _653 => _653("["), 'optionalAccess', _654 => _654.shift, 'call', _655 => _655(), 'optionalAccess', _656 => _656.trim, 'call', _657 => _657()])||null,poster:_optionalChain([n, 'call', _658 => _658(c), 'access', _659 => _659.find, 'call', _660 => _660(".deslide-cover .deslide-cover-img .film-poster-img"), 'optionalAccess', _661 => _661.attr, 'call', _662 => _662("data-src"), 'optionalAccess', _663 => _663.trim, 'call', _664 => _664()])||null,jname:_optionalChain([n, 'call', _665 => _665(c), 'access', _666 => _666.find, 'call', _667 => _667(".deslide-item-content .desi-head-title.dynamic-name"), 'optionalAccess', _668 => _668.attr, 'call', _669 => _669("data-jname"), 'optionalAccess', _670 => _670.trim, 'call', _671 => _671()])||null,episodes:{sub:Number(_optionalChain([n, 'call', _672 => _672(c), 'access', _673 => _673.find, 'call', _674 => _674(".deslide-item-content .sc-detail .scd-item .tick-item.tick-sub"), 'optionalAccess', _675 => _675.text, 'call', _676 => _676(), 'optionalAccess', _677 => _677.trim, 'call', _678 => _678()]))||null,dub:Number(_optionalChain([n, 'call', _679 => _679(c), 'access', _680 => _680.find, 'call', _681 => _681(".deslide-item-content .sc-detail .scd-item .tick-item.tick-dub"), 'optionalAccess', _682 => _682.text, 'call', _683 => _683(), 'optionalAccess', _684 => _684.trim, 'call', _685 => _685()]))||null},type:_optionalChain([l, 'optionalAccess', _686 => _686[0]])||null,otherInfo:l})}),n("#trending-home .swiper-wrapper .swiper-slide").each((u,c)=>{t.trendingAnimes.push({rank:parseInt(_optionalChain([n, 'call', _687 => _687(c), 'access', _688 => _688.find, 'call', _689 => _689(".item .number"), 'optionalAccess', _690 => _690.children, 'call', _691 => _691(), 'optionalAccess', _692 => _692.first, 'call', _693 => _693(), 'optionalAccess', _694 => _694.text, 'call', _695 => _695(), 'optionalAccess', _696 => _696.trim, 'call', _697 => _697()])),id:_optionalChain([n, 'call', _698 => _698(c), 'access', _699 => _699.find, 'call', _700 => _700(".item .film-poster"), 'optionalAccess', _701 => _701.attr, 'call', _702 => _702("href"), 'optionalAccess', _703 => _703.slice, 'call', _704 => _704(1), 'optionalAccess', _705 => _705.trim, 'call', _706 => _706()])||null,name:_optionalChain([n, 'call', _707 => _707(c), 'access', _708 => _708.find, 'call', _709 => _709(".item .number .film-title.dynamic-name"), 'optionalAccess', _710 => _710.text, 'call', _711 => _711(), 'optionalAccess', _712 => _712.trim, 'call', _713 => _713()]),jname:_optionalChain([n, 'call', _714 => _714(c), 'access', _715 => _715.find, 'call', _716 => _716(".item .number .film-title.dynamic-name"), 'optionalAccess', _717 => _717.attr, 'call', _718 => _718("data-jname"), 'optionalAccess', _719 => _719.trim, 'call', _720 => _720()])||null,poster:_optionalChain([n, 'call', _721 => _721(c), 'access', _722 => _722.find, 'call', _723 => _723(".item .film-poster .film-poster-img"), 'optionalAccess', _724 => _724.attr, 'call', _725 => _725("data-src"), 'optionalAccess', _726 => _726.trim, 'call', _727 => _727()])||null})});let s="#main-content .block_area_home:nth-of-type(1) .tab-content .film_list-wrap .flw-item";t.latestEpisodeAnimes=S(n,s,C.name);let m="#main-content .block_area_home:nth-of-type(3) .tab-content .film_list-wrap .flw-item";return t.topUpcomingAnimes=S(n,m,C.name),n("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((u,c)=>{t.genres.push(`${n(c).text().trim()}`)}),n('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((u,c)=>{let l=_optionalChain([n, 'call', _728 => _728(c), 'access', _729 => _729.attr, 'call', _730 => _730("id"), 'optionalAccess', _731 => _731.split, 'call', _732 => _732("-"), 'optionalAccess', _733 => _733.pop, 'call', _734 => _734(), 'optionalAccess', _735 => _735.trim, 'call', _736 => _736()]);if(l==="day"){t.top10Animes.today=_(n,l,C.name);return}if(l==="week"){t.top10Animes.week=_(n,l,C.name);return}l==="month"&&(t.top10Animes.month=_(n,l,C.name))}),t.topAiringAnimes=b(n,"#anime-featured .row div:nth-of-type(1) .anif-block-ul ul li",C.name),t.mostPopularAnimes=b(n,"#anime-featured .row div:nth-of-type(2) .anif-block-ul ul li",C.name),t.mostFavoriteAnimes=b(n,"#anime-featured .row div:nth-of-type(3) .anif-block-ul ul li",C.name),t.latestCompletedAnimes=b(n,"#anime-featured .row div:nth-of-type(4) .anif-block-ul ul li",C.name),t}catch(e){throw d.wrapError(e,C.name)}}exports.AniwatchError = d; exports.getAnimeAboutInfo = U; exports.getAnimeCategory = I; exports.getAnimeEpisodeSources = L; exports.getAnimeEpisodes = H; exports.getAnimeSearchResults = M; exports.getAnimeSearchSuggestion = J; exports.getEpisodeServers = z; exports.getEstimatedSchedule = Y; exports.getGenreAnime = j; exports.getHomePage = C; exports.getProducerAnimes = v;
