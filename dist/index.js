import{load as Ee}from"cheerio";import we,{AxiosError as Xe}from"axios";var Z="gzip, deflate, br",P="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4692.71 Safari/537.36",ee="text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",Se="hianime.to",x=`https://${Se}`,C=`${x}/ajax`,U=`${x}/home`,te=`${x}/search`,re={action:1,adventure:2,cars:3,comedy:4,dementia:5,demons:6,drama:8,ecchi:9,fantasy:10,game:11,harem:35,historical:13,horror:14,isekai:44,josei:43,kids:15,magic:16,"martial-arts":17,mecha:18,military:38,music:19,mystery:7,parody:20,police:39,psychological:40,romance:22,samurai:21,school:23,"sci-fi":24,seinen:42,shoujo:25,"shoujo-ai":26,shounen:27,"shounen-ai":28,"slice-of-life":36,space:29,sports:30,"super-power":31,supernatural:37,thriller:41,vampire:32},ie={all:0,movie:1,tv:2,ova:3,ona:4,special:5,music:6},ne={all:0,"finished-airing":1,"currently-airing":2,"not-yet-aired":3},ae={all:0,g:1,pg:2,"pg-13":3,r:4,"r+":5,rx:6},oe={all:0,appalling:1,horrible:2,"very-bad":3,bad:4,average:5,fine:6,good:7,"very-good":8,great:9,masterpiece:10},se={all:0,spring:1,summer:2,fall:3,winter:4},ce={all:0,sub:1,dub:2,"sub-&-dub":3},me={default:"default","recently-added":"recently_added","recently-updated":"recently_updated",score:"score","name-a-z":"name_az","released-date":"released_date","most-watched":"most_watched"};function A(i={}){return we.create({timeout:8e3,...i,headers:{...i.headers,Accept:ee,"User-Agent":P,"Accept-Encoding":Z}})}import{AxiosError as _e}from"axios";var Re="\x1B[31m%s\x1B[0m",H="Something went wrong",d=class i extends Error{scraper;constructor(t,e){super(`${e}: ${t}`),this.name=i.name,this.scraper=e,Error.captureStackTrace&&Error.captureStackTrace(this,i),this.logError()}static wrapError(t,e){if(t instanceof i)return t;if(t instanceof _e){let a=t?.response?.statusText||H;return new i("fetch_err: "+a,e)}return new i(t?.message||H,e)}logError(){console.error(Re,JSON.stringify({scraper:this.scraper,message:this?.message||H},null,2))}};var w=(i,t,e)=>{try{let a=[];return i(t).each((n,o)=>{let r=i(o).find(".film-detail .film-name .dynamic-name")?.attr("href")?.slice(1).split("?ref=search")[0]||null;a.push({id:r,name:i(o).find(".film-detail .film-name .dynamic-name")?.text()?.trim(),jname:i(o).find(".film-detail .film-name .dynamic-name")?.attr("data-jname")?.trim()||null,poster:i(o).find(".film-poster .film-poster-img")?.attr("data-src")?.trim()||null,duration:i(o).find(".film-detail .fd-infor .fdi-item.fdi-duration")?.text()?.trim(),type:i(o).find(".film-detail .fd-infor .fdi-item:nth-of-type(1)")?.text()?.trim(),rating:i(o).find(".film-poster .tick-rate")?.text()?.trim()||null,episodes:{sub:Number(i(o).find(".film-poster .tick-sub")?.text()?.trim().split(" ").pop())||null,dub:Number(i(o).find(".film-poster .tick-dub")?.text()?.trim().split(" ").pop())||null}})}),a}catch(a){throw d.wrapError(a,e)}},R=(i,t,e)=>{try{let a=[],n=`#top-viewed-${t} ul li`;return i(n).each((o,r)=>{a.push({id:i(r).find(".film-detail .dynamic-name")?.attr("href")?.slice(1).trim()||null,rank:Number(i(r).find(".film-number span")?.text()?.trim())||null,name:i(r).find(".film-detail .dynamic-name")?.text()?.trim()||null,jname:i(r).find(".film-detail .dynamic-name")?.attr("data-jname")?.trim()||null,poster:i(r).find(".film-poster .film-poster-img")?.attr("data-src")?.trim()||null,episodes:{sub:Number(i(r).find(".film-detail .fd-infor .tick-item.tick-sub")?.text()?.trim())||null,dub:Number(i(r).find(".film-detail .fd-infor .tick-item.tick-dub")?.text()?.trim())||null}})}),a}catch(a){throw d.wrapError(a,e)}},S=(i,t,e)=>{try{let a=[];return i(t).each((n,o)=>{a.push({id:i(o).find(".film-detail .dynamic-name")?.attr("href")?.slice(1).trim()||null,name:i(o).find(".film-detail .dynamic-name")?.text()?.trim()||null,jname:i(o).find(".film-detail .film-name .dynamic-name").attr("data-jname")?.trim()||null,poster:i(o).find(".film-poster .film-poster-img")?.attr("data-src")?.trim()||null,episodes:{sub:Number(i(o)?.find(".fd-infor .tick .tick-sub")?.text()?.trim())||null,dub:Number(i(o)?.find(".fd-infor .tick .tick-dub")?.text()?.trim())||null},type:i(o)?.find(".fd-infor .tick")?.text()?.trim()?.replace(/[\s\n]+/g," ")?.split(" ")?.pop()||null})}),a}catch(a){throw d.wrapError(a,e)}};function j(i,t,e){return i(`.ps_-block.ps_-block-sub.servers-${e} > .ps__-list .server-item`)?.map((a,n)=>i(n).attr("data-server-id")==`${t}`?i(n):null)?.get()[0]?.attr("data-id")||null}function Ce(i){if(!(i.length<1))return i.map(t=>re[t]).join(",")}function le(i,t){if(t=t.trim(),!!t)switch(i){case"genres":return Ce(t.split(","));case"type":{let e=ie[t]??0;return e===0?void 0:`${e}`}case"status":{let e=ne[t]??0;return e===0?void 0:`${e}`}case"rated":{let e=ae[t]??0;return e===0?void 0:`${e}`}case"score":{let e=oe[t]??0;return e===0?void 0:`${e}`}case"season":{let e=se[t]??0;return e===0?void 0:`${e}`}case"language":{let e=ce[t]??0;return e===0?void 0:`${e}`}case"sort":return me[t]??void 0;default:return}}function pe(i,t){if(t=t.trim(),!t)return;let e=/^\d{4}-([0-9]|1[0-2])-([0-9]|[12][0-9]|3[01])$/,a=i?"s":"e",[n,o,r]=t.split("-");if(e.test(t))return[Number(n)>0?`${a}y=${n}`:"",Number(o)>0?`${a}m=${o}`:"",Number(r)>0?`${a}d=${r}`:""].filter(s=>!!s)}function de(i,t){let e=i.indexOf(t);return e==-1?"":i.substring(e+t.length)}function ue(i,t){let e=i.indexOf(t);return e==-1?"":i.substring(0,e)}async function L(i,t={}){let e={anime:{info:{id:null,anilistId:null,malId:null,name:null,poster:null,description:null,stats:{rating:null,quality:null,episodes:{sub:null,dub:null},type:null,duration:null},promotionalVideos:[],charactersVoiceActors:[]},moreInfo:{}},seasons:[],mostPopularAnimes:[],relatedAnimes:[],recommendedAnimes:[]};try{if(i.trim()===""||i.indexOf("-")===-1)throw new d("invalid anime id",L.name);let a=new URL(i,x),o=await A(t).get(a.href),r=Ee(o.data);try{let c=JSON.parse(r("body")?.find("#syncData")?.text());e.anime.info.anilistId=c?.anilist_id?Number(c?.anilist_id):null,e.anime.info.malId=c?.anilist_id?Number(c?.malId):null}catch{e.anime.info.anilistId=null,e.anime.info.malId=null}let s="#ani_detail .container .anis-content";e.anime.info.id=r(s)?.find(".anisc-detail .film-buttons a.btn-play")?.attr("href")?.split("/")?.pop()||null,e.anime.info.name=r(s)?.find(".anisc-detail .film-name.dynamic-name")?.text()?.trim()||null,e.anime.info.description=r(s)?.find(".anisc-detail .film-description .text").text()?.split("[")?.shift()?.trim()||null,e.anime.info.poster=r(s)?.find(".film-poster .film-poster-img")?.attr("src")?.trim()||null,e.anime.info.stats.rating=r(`${s} .film-stats .tick .tick-pg`)?.text()?.trim()||null,e.anime.info.stats.quality=r(`${s} .film-stats .tick .tick-quality`)?.text()?.trim()||null,e.anime.info.stats.episodes={sub:Number(r(`${s} .film-stats .tick .tick-sub`)?.text()?.trim())||null,dub:Number(r(`${s} .film-stats .tick .tick-dub`)?.text()?.trim())||null},e.anime.info.stats.type=r(`${s} .film-stats .tick`)?.text()?.trim()?.match(/(TV|OVA|Movie|ONA|Special)/g)?.[0]||null,e.anime.info.stats.duration=r(`${s} .film-stats .tick`)?.text()?.trim()?.match(/((:?[0-9]{0,2}h )?[0-9]{0,2}m)/g)?.[0]||null,r(".block_area.block_area-promotions .block_area-promotions-list .screen-items .item").each((c,l)=>{e.anime.info.promotionalVideos.push({title:r(l).attr("data-title"),source:r(l).attr("data-src"),thumbnail:r(l).find("img").attr("src")})}),r(".block_area.block_area-actors .block-actors-content .bac-list-wrap .bac-item").each((c,l)=>{e.anime.info.charactersVoiceActors.push({character:{id:r(l).find(r(".per-info.ltr .pi-avatar")).attr("href")?.split("/")[2]||"",poster:r(l).find(r(".per-info.ltr .pi-avatar img")).attr("data-src")||"",name:r(l).find(r(".per-info.ltr .pi-detail a")).text(),cast:r(l).find(r(".per-info.ltr .pi-detail .pi-cast")).text()},voiceActor:{id:r(l).find(r(".per-info.rtl .pi-avatar")).attr("href")?.split("/")[2]||"",poster:r(l).find(r(".per-info.rtl .pi-avatar img")).attr("data-src")||"",name:r(l).find(r(".per-info.rtl .pi-detail a")).text(),cast:r(l).find(r(".per-info.rtl .pi-detail .pi-cast")).text()}})}),r(`${s} .anisc-info-wrap .anisc-info .item:not(.w-hide)`).each((c,l)=>{let f=r(l).find(".item-head").text().toLowerCase().replace(":","").trim();f=f.includes(" ")?f.replace(" ",""):f;let k=[...r(l).find("*:not(.item-head)").map((_,b)=>r(b).text().trim())].map(_=>`${_}`).toString().trim();if(["studios","genres","producers"].includes(f)){e.anime.moreInfo[f]=k.split(",").map(_=>_.trim());return}e.anime.moreInfo[f]=k}),r("#main-content .os-list a.os-item").each((c,l)=>{e.seasons.push({id:r(l)?.attr("href")?.slice(1)?.trim()||null,name:r(l)?.attr("title")?.trim()||null,title:r(l)?.find(".title")?.text()?.trim(),poster:r(l)?.find(".season-poster")?.attr("style")?.split(" ")?.pop()?.split("(")?.pop()?.split(")")[0]||null,isCurrent:r(l).hasClass("active")})});let p="#main-sidebar .block_area.block_area_sidebar.block_area-realtime:nth-of-type(1) .anif-block-ul ul li";e.relatedAnimes=S(r,p,L.name);let h="#main-sidebar .block_area.block_area_sidebar.block_area-realtime:nth-of-type(2) .anif-block-ul ul li";e.mostPopularAnimes=S(r,h,L.name);let u="#main-content .block_area.block_area_category .tab-content .flw-item";return e.recommendedAnimes=w(r,u,L.name),e}catch(a){throw d.wrapError(a,L.name)}}import{load as ke}from"cheerio";async function T(i,t=1,e={}){let a={animes:[],genres:[],top10Animes:{today:[],week:[],month:[]},category:i,totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};try{if(i.trim()==="")throw new d("invalid anime category",T.name);t=t<1?1:t;let n=new URL(i,x),r=await A(e).get(`${n}?page=${t}`),s=ke(r.data),m="#main-content .tab-content .film_list-wrap .flw-item",p="#main-content .block_area .block_area-header .cat-heading";return a.category=s(p)?.text()?.trim()??i,a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(s('.pagination > .page-item a[title="Last"]')?.attr("href")?.split("=").pop()??s('.pagination > .page-item a[title="Next"]')?.attr("href")?.split("=").pop()??s(".pagination > .page-item.active a")?.text()?.trim())||1,a.animes=w(s,m,T.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0),s("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((c,l)=>{a.genres.push(`${s(l).text().trim()}`)}),s('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((c,l)=>{let f=s(l).attr("id")?.split("-")?.pop()?.trim();if(f==="day"){a.top10Animes.today=R(s,f,T.name);return}if(f==="week"){a.top10Animes.week=R(s,f,T.name);return}f==="month"&&(a.top10Animes.month=R(s,f,T.name))}),a}catch(n){throw d.wrapError(n,T.name)}}import{load as Pe}from"cheerio";async function O(i,t={}){let e={totalEpisodes:0,episodes:[]};try{if(i.trim()===""||i.indexOf("-")===-1)throw new d("invalid anime id",O.name);let n=await A(t).get(`${C}/v2/episode/list/${i.split("-").pop()}`,{headers:{"X-Requested-With":"XMLHttpRequest",Referer:`${x}/watch/${i}`}}),o=Pe(n.data.html);return e.totalEpisodes=Number(o(".detail-infor-content .ss-list a").length),o(".detail-infor-content .ss-list a").each((r,s)=>{e.episodes.push({title:o(s)?.attr("title")?.trim()||null,episodeId:o(s)?.attr("href")?.split("/")?.pop()||null,number:Number(o(s).attr("data-number")),isFiller:o(s).hasClass("ssl-item-filler")})}),e}catch(a){throw d.wrapError(a,O.name)}}import Te from"axios";import{load as xe}from"cheerio";import fe from"crypto";import he from"axios";var ge={script:"https://megacloud.tv/js/player/a/prod/e1-player.min.js?v=",sources:"https://megacloud.tv/embed-2/ajax/e-1/getSources?id="},F=class{async extract(t){try{let e={tracks:[],intro:{start:0,end:0},outro:{start:0,end:0},sources:[]},a=t?.href?.split("/")?.pop()?.split("?")[0],{data:n}=await he.get(ge.sources.concat(a||""),{headers:{Accept:"*/*","X-Requested-With":"XMLHttpRequest","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36",Referer:t.href}});if(!n)throw new d("Url may have an invalid video id","getAnimeEpisodeSources");let o=n.sources;if(!n.encrypted&&Array.isArray(o))return e.intro=n.intro,e.outro=n.outro,e.tracks=n.tracks,e.sources=o.map(c=>({url:c.file,type:c.type})),e;let r,{data:s}=await he.get(ge.script.concat(Date.now().toString()));if(r=s,!r)throw new d("Couldn't fetch script to decrypt resource","getAnimeEpisodeSources");let m=this.extractVariables(r);if(!m.length)throw new Error("Can't find variables. Perhaps the extractor is outdated.");let{secret:p,encryptedSource:h}=this.getSecret(o,m),u=this.decrypt(h,p);try{let c=JSON.parse(u);return e.intro=n.intro,e.outro=n.outro,e.tracks=n.tracks,e.sources=c.map(l=>({url:l.file,type:l.type})),e}catch{throw new d("Failed to decrypt resource","getAnimeEpisodeSources")}}catch(e){throw e}}extractVariables(t){let e=/case\s*0x[0-9a-f]+:(?![^;]*=partKey)\s*\w+\s*=\s*(\w+)\s*,\s*\w+\s*=\s*(\w+);/g,a=t.matchAll(e);return Array.from(a,o=>{let r=this.matchingKey(o[1],t),s=this.matchingKey(o[2],t);try{return[parseInt(r,16),parseInt(s,16)]}catch{return[]}}).filter(o=>o.length>0)}getSecret(t,e){let a="",n="",o=t.split(""),r=0;for(let s of e){let m=s[0]+r,p=m+s[1];for(let h=m;h<p;h++)a+=t[h],o[h]="";r+=s[1]}return n=o.join(""),{secret:a,encryptedSource:n}}decrypt(t,e,a){let n,o,r;if(a)n=e,o=a,r=t;else{let p=Buffer.from(t,"base64"),h=p.subarray(8,16),u=Buffer.concat([Buffer.from(e,"binary"),h]),c=[],l=u;for(let f=0;f<3;f++)c[f]=fe.createHash("md5").update(l).digest(),l=Buffer.concat([c[f],u]);n=Buffer.concat([c[0],c[1]]),o=c[2],r=p.subarray(16)}let s=fe.createDecipheriv("aes-256-cbc",n,o);return s.update(r,typeof r=="string"?"base64":void 0,"utf8")+s.final()}matchingKey(t,e){let a=new RegExp(`,${t}=((?:0x)?([0-9a-fA-F]+))`),n=e.match(a);if(n)return n[1].replace(/^0x/,"");throw new Error("Failed to match the key")}},V=F;import D from"axios";import ye from"crypto-js";var X=class{sources=[];fallbackKey="c1d17096f2ca11b7";host="https://rapid-cloud.co";async extract(t){let e={sources:[],subtitles:[]};try{let a=t.href.split("/").pop()?.split("?")[0],n={headers:{"X-Requested-With":"XMLHttpRequest"}},o=null;o=await D.get(`https://${t.hostname}/embed-2/ajax/e-1/getSources?id=${a}`,n);let{data:{sources:r,tracks:s,intro:m,outro:p,encrypted:h}}=o,u=await(await D.get("https://raw.githubusercontent.com/cinemaxhq/keys/e1/key")).data;u=ue(de(u,'"blob-code blob-code-inner js-file-line">'),"</td>"),u||(u=await(await D.get("https://raw.githubusercontent.com/cinemaxhq/keys/e1/key")).data),u||(u=this.fallbackKey);try{if(h){let c=r.split(""),l="",f=0;for(let _ of u){let b=_[0]+f,v=b+_[1];for(let N=b;N<v;N++)l+=o.data.sources[N],c[N]="";f+=_[1]}u=l,r=c.join("");let k=ye.AES.decrypt(r,u);r=JSON.parse(k.toString(ye.enc.Utf8))}}catch(c){throw console.log(c.message),new Error("Cannot decrypt sources. Perhaps the key is invalid.")}if(this.sources=r?.map(c=>({url:c.file,isM3U8:c.file.includes(".m3u8")})),e.sources.push(...this.sources),t.href.includes(new URL(this.host).host)){e.sources=[],this.sources=[];for(let c of r){let{data:l}=await D.get(c.file,n),_=l.split(`
`).filter(b=>b.includes(".m3u8")&&b.includes("RESOLUTION=")).map(b=>b.match(/RESOLUTION=.*,(C)|URI=.*/g)?.map(v=>v.split("=")[1])).map(b=>{let v=b[0].split(",C")[0],N=b[1].replace(/"/g,"");return[v,N]});for(let[b,v]of _)this.sources.push({url:`${c.file?.split("master.m3u8")[0]}${v.replace("iframes","index")}`,quality:b.split("x")[1]+"p",isM3U8:v.includes(".m3u8")});e.sources.push(...this.sources)}}return e.intro=m?.end>1?{start:m.start,end:m.end}:void 0,e.outro=p?.end>1?{start:p.start,end:p.end}:void 0,e.sources.push({url:r[0].file,isM3U8:r[0].file.includes(".m3u8"),quality:"auto"}),e.subtitles=s.map(c=>c.file?{url:c.file,lang:c.label?c.label:"Thumbnails"}:null).filter(c=>c),e}catch(a){throw console.log(a.message),a}}},B=X;import Ae from"axios";var K=class{sources=[];host="https://watchsb.com/sources50";host2="https://streamsss.net/sources16";PAYLOAD(t){return`566d337678566f743674494a7c7c${t}7c7c346b6767586d6934774855537c7c73747265616d7362/6565417268755339773461447c7c346133383438333436313335376136323337373433383634376337633465366534393338373136643732373736343735373237613763376334363733353737303533366236333463353333363534366137633763373337343732363536313664373336327c7c6b586c3163614468645a47617c7c73747265616d7362`}async extract(t,e=!1){let a={watchsb:"sbstream",Referer:t.href,"User-Agent":P},n=t.href.split("/e/").pop();n?.includes("html")&&(n=n.split(".html")[0]);let o=new TextEncoder().encode(n),r=await Ae.get(`${e?this.host2:this.host}/${this.PAYLOAD(Buffer.from(o).toString("hex"))}`,{headers:a}).catch(()=>null);if(!r?.data.stream_data)throw new Error("No source found. Try a different server");a={"User-Agent":P,Referer:t.href.split("e/")[0]};let m=(await Ae.get(r.data.stream_data.file,{headers:a}))?.data?.split("#EXT-X-STREAM-INF:")??[];for(let p of m){if(!p.includes("m3u8"))continue;let h=p.split(`
`)[1],u=p.split("RESOLUTION=")[1].split(",")[0].split("x")[1];this.sources.push({url:h,quality:`${u}p`,isM3U8:!0})}return this.sources.push({url:r.data.stream_data.file,quality:"auto",isM3U8:r.data.stream_data.file.includes(".m3u8")}),this.sources}},G=K;import ve from"axios";import{load as Ie}from"cheerio";var W=class{sources=[];async extract(t){try{let{data:e}=await ve.get(t.href).catch(()=>{throw new Error("Video not found")}),a=Ie(e),[n,o]=a.html()?.match(/robotlink'\).innerHTML = (.*)'/)[1].split("+ ('");o=o.substring(3),n=n.replace(/\'/g,"");let r=`https:${n}${o}`;return this.sources.push({url:r,isM3U8:r.includes(".m3u8")}),this.sources}catch(e){throw new Error(e.message)}}},J=W;async function be(i,t="hd-1",e="sub",a={}){if(i.startsWith("http")){let o=new URL(i);switch(t){case"hd-1":case"hd-2":return{...await new V().extract(o)};case"streamsb":return{headers:{Referer:o.href,watchsb:"streamsb","User-Agent":P},sources:await new G().extract(o,!0)};case"streamtape":return{headers:{Referer:o.href,"User-Agent":P},sources:await new J().extract(o)};default:return{headers:{Referer:o.href},...await new B().extract(o)}}}let n=new URL(`/watch/${i}`,x).href;console.log("EPISODE_ID: ",n);try{let o=A(a),r=await o.get(`${C}/v2/episode/servers?episodeId=${n.split("?ep=")[1]}`,{headers:{Referer:n,"X-Requested-With":"XMLHttpRequest"}}),s=xe(r.data.html),m=null;try{switch(console.log("THE SERVER: ",t),t){case"hd-2":{if(m=j(s,1,e),!m)throw new Error("RapidCloud not found");break}case"hd-1":{if(m=j(s,4,e),console.log("SERVER_ID: ",m),!m)throw new Error("VidStreaming not found");break}case"streamsb":{if(m=j(s,5,e),!m)throw new Error("StreamSB not found");break}case"streamtape":{if(m=j(s,3,e),!m)throw new Error("StreamTape not found");break}}}catch{throw new d("Couldn't find server. Try another server",M.name)}let{data:{link:p}}=await o.get(`${C}/v2/episode/sources?id=${m}`);return console.log("THE LINK: ",p),await be(p,t)}catch(o){throw d.wrapError(o,M.name)}}async function M(i,t="hd-1",e="sub"){try{if(i===""||i.indexOf("?ep=")===-1)throw new d("invalid anime episode id",M.name);if(e.trim()==="")throw new d("invalid anime episode category",M.name);let a,n,o=new URL(i?.split("?ep=")[0],x)?.href,[r,s]=await Promise.all([be(i,t,e),Te.get(o,{headers:{Referer:x,"User-Agent":P,"X-Requested-With":"XMLHttpRequest"}})]),m=xe(s?.data);try{n=Number(JSON.parse(m("body")?.find("#syncData")?.text())?.anilist_id),a=Number(JSON.parse(m("body")?.find("#syncData")?.text())?.mal_id)}catch{n=null,a=null}return{...r,anilistID:n,malID:a}}catch(a){throw d.wrapError(a,M.name)}}import{load as Ne}from"cheerio";async function q(i,t=1,e={}){let a={genreName:i,animes:[],genres:[],topAiringAnimes:[],totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};i=i==="martial-arts"?"marial-arts":i;try{if(i.trim()==="")throw new d("invalid genre name",q.name);t=t<1?1:t;let n=new URL(`/genre/${i}?page=${t}`,x),r=await A(e).get(n.href),s=Ne(r.data),m="#main-content .tab-content .film_list-wrap .flw-item",p="#main-content .block_area .block_area-header .cat-heading";a.genreName=s(p)?.text()?.trim()??i,a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(s('.pagination > .page-item a[title="Last"]')?.attr("href")?.split("=").pop()??s('.pagination > .page-item a[title="Next"]')?.attr("href")?.split("=").pop()??s(".pagination > .page-item.active a")?.text()?.trim())||1,a.animes=w(s,m,q.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0),s("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((c,l)=>{a.genres.push(`${s(l).text().trim()}`)});let u="#main-sidebar .block_area.block_area_sidebar.block_area-realtime .anif-block-ul ul li";return a.topAiringAnimes=S(s,u,q.name),a}catch(n){throw d.wrapError(n,q.name)}}import{load as Ue}from"cheerio";async function I(i,t=1,e={}){let a={producerName:i,animes:[],top10Animes:{today:[],week:[],month:[]},topAiringAnimes:[],totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)};try{if(i.trim()==="")throw new d("invalid producer name",I.name);t=t<1?1:t;let n=new URL(`/producer/${i}?page=${t}`,x),r=await A(e).get(n.href),s=Ue(r.data),m="#main-content .tab-content .film_list-wrap .flw-item";a.hasNextPage=s(".pagination > li").length>0&&s(".pagination li.active").length>0?!s(".pagination > li").last().hasClass("active"):!1,a.totalPages=Number(s('.pagination > .page-item a[title="Last"]')?.attr("href")?.split("=").pop()??s('.pagination > .page-item a[title="Next"]')?.attr("href")?.split("=").pop()??s(".pagination > .page-item.active a")?.text()?.trim())||1,a.animes=w(s,m,I.name),a.animes.length===0&&!a.hasNextPage&&(a.totalPages=0);let p="#main-content .block_area .block_area-header .cat-heading";a.producerName=s(p)?.text()?.trim()??i,s('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((c,l)=>{let f=s(l).attr("id")?.split("-")?.pop()?.trim();if(f==="day"){a.top10Animes.today=R(s,f,I.name);return}if(f==="week"){a.top10Animes.week=R(s,f,I.name);return}f==="month"&&(a.top10Animes.month=R(s,f,I.name))});let u="#main-sidebar .block_area_sidebar:nth-child(2) .block_area-content .anif-block-ul ul li";return a.topAiringAnimes=S(s,u,I.name),a}catch(n){throw d.wrapError(n,I.name)}}import{load as Le}from"cheerio";var Me={filter:!0,type:!0,status:!0,rated:!0,score:!0,season:!0,language:!0,start_date:!0,end_date:!0,sort:!0,genres:!0};async function $e(i,t=1,e,a={}){try{let n={animes:[],mostPopularAnimes:[],searchQuery:i,searchFilters:e,totalPages:1,hasNextPage:!1,currentPage:(Number(t)||0)<1?1:Number(t)},o=new URL(te);o.searchParams.set("keyword",i),o.searchParams.set("page",`${t}`),o.searchParams.set("sort","default");for(let u in e){if(u.includes("_date")){let l=pe(u==="start_date",e[u]||"");if(!l)continue;l.map(f=>{let[k,_]=f.split("=");o.searchParams.set(k,_)});continue}let c=le(u,e[u]||"");c&&o.searchParams.set(u,c)}let s=await A(a).get(o.href),m=Le(s.data),p="#main-content .tab-content .film_list-wrap .flw-item";n.hasNextPage=m(".pagination > li").length>0&&m(".pagination li.active").length>0?!m(".pagination > li").last().hasClass("active"):!1,n.totalPages=Number(m('.pagination > .page-item a[title="Last"]')?.attr("href")?.split("=").pop()??m('.pagination > .page-item a[title="Next"]')?.attr("href")?.split("=").pop()??m(".pagination > .page-item.active a")?.text()?.trim())||1,n.animes=w(m,p,$.name),n.animes.length===0&&!n.hasNextPage&&(n.totalPages=0);let h="#main-sidebar .block_area.block_area_sidebar.block_area-realtime .anif-block-ul ul li";return n.mostPopularAnimes=S(m,h,$.name),n}catch(n){throw d.wrapError(n,$.name)}}async function $(i,t=1,e={}){try{if(i=i.trim()?decodeURIComponent(i.trim()):"",i.trim()==="")throw new d("invalid search query",$.name);t=t<1?1:t;let a={};for(let n in e)Me[n]&&(a[n]=e[n]);return $e(i,t,a)}catch(a){throw d.wrapError(a,$.name)}}import{load as je}from"cheerio";async function z(i,t={}){try{let e={suggestions:[]};if(i=i.trim()?decodeURIComponent(i.trim()):"",i.trim()==="")throw new d("invalid search query",z.name);let a=A(t),{data:n}=await a.get(`${C}/search/suggest?keyword=${encodeURIComponent(i)}`,{headers:{Accept:"*/*",Pragma:"no-cache",Referer:U,"X-Requested-With":"XMLHttpRequest"}}),o=je(n.html),r=".nav-item:has(.film-poster)";return o(r).length<1||o(r).each((s,m)=>{let p=o(m).attr("href")?.split("?")[0].includes("javascript")?null:o(m).attr("href")?.split("?")[0]?.slice(1)||null;e.suggestions.push({id:p,name:o(m).find(".srp-detail .film-name")?.text()?.trim()||null,jname:o(m).find(".srp-detail .film-name")?.attr("data-jname")?.trim()||o(m).find(".srp-detail .alias-name")?.text()?.trim()||null,poster:o(m).find(".film-poster .film-poster-img")?.attr("data-src")?.trim()||null,moreInfo:[...o(m).find(".film-infor").contents().map((h,u)=>o(u).text().trim())].filter(h=>h)})}),e}catch(e){throw d.wrapError(e,z.name)}}import{load as qe}from"cheerio";async function Y(i,t={}){let e={sub:[],dub:[],raw:[],episodeId:i,episodeNo:0};try{if(i.trim()===""||i.indexOf("?ep=")===-1)throw new d("invalid anime episode id",Y.name);let a=i.split("?ep=")[1],n=A(t),{data:o}=await n.get(`${C}/v2/episode/servers?episodeId=${a}`,{headers:{"X-Requested-With":"XMLHttpRequest",Referer:new URL(`/watch/${i}`,x).href}}),r=qe(o.html),s=".server-notice strong";return e.episodeNo=Number(r(s).text().split(" ").pop())||0,r(".ps_-block.ps_-block-sub.servers-sub .ps__-list .server-item").each((m,p)=>{e.sub.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(r(p)?.attr("data-server-id")?.trim())||null})}),r(".ps_-block.ps_-block-sub.servers-dub .ps__-list .server-item").each((m,p)=>{e.dub.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(r(p)?.attr("data-server-id")?.trim())||null})}),r(".ps_-block.ps_-block-sub.servers-raw .ps__-list .server-item").each((m,p)=>{e.raw.push({serverName:r(p).find("a").text().toLowerCase().trim(),serverId:Number(r(p)?.attr("data-server-id")?.trim())||null})}),e}catch(a){throw d.wrapError(a,Y.name)}}import{load as De}from"cheerio";async function Q(i,t={}){let e={scheduledAnimes:[]};try{if(i=i?.trim(),i===""||/^\d{4}-\d{2}-\d{2}$/.test(i)===!1)throw new d("invalid date format",Q.name);let a=`${C}/schedule/list?tzOffset=-330&date=${i}`,o=await A(t).get(a,{headers:{Accept:"*/*",Referer:U,"X-Requested-With":"XMLHttpRequest"}}),r=De(o?.data?.html),s="li";return r(s)?.text()?.trim()?.includes("No data to display")||r(s).each((m,p)=>{let h=new Date(`${i}T${r(p)?.find("a .time")?.text()?.trim()}:00`).getTime();e.scheduledAnimes.push({id:r(p)?.find("a")?.attr("href")?.slice(1)?.trim()||null,time:r(p)?.find("a .time")?.text()?.trim()||null,name:r(p)?.find("a .film-name.dynamic-name")?.text()?.trim()||null,jname:r(p)?.find("a .film-name.dynamic-name")?.attr("data-jname")?.trim()||null,airingTimestamp:h,secondsUntilAiring:Math.floor((h-Date.now())/1e3),episode:Number(r(p).find("a .fd-play button").text().trim().split(" ")[1])})}),e}catch(a){throw d.wrapError(a,Q.name)}}import{load as He}from"cheerio";async function E(i={}){let t={spotlightAnimes:[],trendingAnimes:[],latestEpisodeAnimes:[],topUpcomingAnimes:[],top10Animes:{today:[],week:[],month:[]},topAiringAnimes:[],mostPopularAnimes:[],mostFavoriteAnimes:[],latestCompletedAnimes:[],genres:[]};try{let a=await A(i).get(U),n=He(a.data);n("#slider .swiper-wrapper .swiper-slide").each((u,c)=>{let l=n(c).find(".deslide-item-content .sc-detail .scd-item").map((f,k)=>n(k).text().trim()).get().slice(0,-1);t.spotlightAnimes.push({rank:Number(n(c).find(".deslide-item-content .desi-sub-text")?.text().trim().split(" ")[0].slice(1))||null,id:n(c).find(".deslide-item-content .desi-buttons a")?.last()?.attr("href")?.slice(1)?.trim()||null,name:n(c).find(".deslide-item-content .desi-head-title.dynamic-name")?.text().trim(),description:n(c).find(".deslide-item-content .desi-description")?.text()?.split("[")?.shift()?.trim()||null,poster:n(c).find(".deslide-cover .deslide-cover-img .film-poster-img")?.attr("data-src")?.trim()||null,jname:n(c).find(".deslide-item-content .desi-head-title.dynamic-name")?.attr("data-jname")?.trim()||null,episodes:{sub:Number(n(c).find(".deslide-item-content .sc-detail .scd-item .tick-item.tick-sub")?.text()?.trim())||null,dub:Number(n(c).find(".deslide-item-content .sc-detail .scd-item .tick-item.tick-dub")?.text()?.trim())||null},type:l?.[0]||null,otherInfo:l})}),n("#trending-home .swiper-wrapper .swiper-slide").each((u,c)=>{t.trendingAnimes.push({rank:parseInt(n(c).find(".item .number")?.children()?.first()?.text()?.trim()),id:n(c).find(".item .film-poster")?.attr("href")?.slice(1)?.trim()||null,name:n(c).find(".item .number .film-title.dynamic-name")?.text()?.trim(),jname:n(c).find(".item .number .film-title.dynamic-name")?.attr("data-jname")?.trim()||null,poster:n(c).find(".item .film-poster .film-poster-img")?.attr("data-src")?.trim()||null})});let s="#main-content .block_area_home:nth-of-type(1) .tab-content .film_list-wrap .flw-item";t.latestEpisodeAnimes=w(n,s,E.name);let m="#main-content .block_area_home:nth-of-type(3) .tab-content .film_list-wrap .flw-item";return t.topUpcomingAnimes=w(n,m,E.name),n("#main-sidebar .block_area.block_area_sidebar.block_area-genres .sb-genre-list li").each((u,c)=>{t.genres.push(`${n(c).text().trim()}`)}),n('#main-sidebar .block_area-realtime [id^="top-viewed-"]').each((u,c)=>{let l=n(c).attr("id")?.split("-")?.pop()?.trim();if(l==="day"){t.top10Animes.today=R(n,l,E.name);return}if(l==="week"){t.top10Animes.week=R(n,l,E.name);return}l==="month"&&(t.top10Animes.month=R(n,l,E.name))}),t.topAiringAnimes=S(n,"#anime-featured .row div:nth-of-type(1) .anif-block-ul ul li",E.name),t.mostPopularAnimes=S(n,"#anime-featured .row div:nth-of-type(2) .anif-block-ul ul li",E.name),t.mostFavoriteAnimes=S(n,"#anime-featured .row div:nth-of-type(3) .anif-block-ul ul li",E.name),t.latestCompletedAnimes=S(n,"#anime-featured .row div:nth-of-type(4) .anif-block-ul ul li",E.name),t}catch(e){throw d.wrapError(e,E.name)}}export{d as AniwatchError,L as getAnimeAboutInfo,T as getAnimeCategory,M as getAnimeEpisodeSources,O as getAnimeEpisodes,$ as getAnimeSearchResults,z as getAnimeSearchSuggestion,Y as getEpisodeServers,Q as getEstimatedSchedule,q as getGenreAnime,E as getHomePage,I as getProducerAnimes};
